"use strict";

function ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }

function _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(source, true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(source).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }

function _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }

var SUMMARY_ACTION = {
  ADD: Symbol(),
  REMOVE: Symbol()
};
var Simpler = {
  initialize: function initialize() {
    initializeUI();
  }
};

function SendData(data) {
  // TODO: ... and this one is pretty ugly, too
  data.forEach(function (entry) {
    var entryDiv = getEntry(entry);
    entryDiv.addEventListener("click", function () {
      return entryClicked(entryDiv, entry);
    });
    addToDataContainer(entryDiv);
  });
  renderSummary(summary);
}

var selected = [];
var summary = {};

function calculateSummary(entry, action) {
  var currency = entry.currency || "LCY";
  summary = _objectSpread({}, summary, _defineProperty({}, currency, summary[currency] || 0));

  switch (action) {
    case SUMMARY_ACTION.REMOVE:
      summary[currency] -= entry.amount;
      break;

    case SUMMARY_ACTION.ADD:
      summary[currency] += entry.amount;
      break;
  }
}

function updateSummary(entry, action) {
  calculateSummary(entry, action);
  renderSummary(summary);
} // TODO: This one is still pretty ugly


function entryClicked(entryDiv, entry) {
  if (selected.includes(entry)) {
    entryDiv.classList.remove("selected");
    selected = selected.filter(function (e) {
      return e !== entry;
    });
    updateSummary(entry, SUMMARY_ACTION.REMOVE);
  } else {
    entryDiv.classList.add("selected");
    selected.push(entry);
    updateSummary(entry, SUMMARY_ACTION.ADD);
  }
}

var dataContainer = document.createElement("div");
dataContainer.className = "data";
var summaryContainer = document.createElement("div");
summaryContainer.className = "summary";

function initializeUI() {
  var controlAddIn = document.getElementById("controlAddIn");
  controlAddIn.appendChild(dataContainer);
  controlAddIn.appendChild(summaryContainer);
}

function emptyChildrenFrom(node) {
  while (node.firstChild) {
    node.removeChild(node.firstChild);
  }
}

function renderSummary(summary) {
  emptyChildrenFrom(summaryContainer);
  var summaryLabel = document.createElement("div");
  summaryLabel.className = "label";
  summaryLabel.innerText = "Payment summary";
  summaryContainer.appendChild(summaryLabel);

  if (!selected.length) {
    var summaryInfo = document.createElement("div");
    summaryInfo.className = "info";
    summaryInfo.innerText = "(no invoices selected)";
    summaryContainer.appendChild(summaryInfo);
    return;
  }

  var table = document.createElement("table");
  table.width = "80%";
  var thead = document.createElement("thead");
  table.appendChild(thead);
  var tr = document.createElement("tr");
  thead.appendChild(tr);
  var tdCurrency = document.createElement("td");
  tdCurrency.width = "30%";
  tdCurrency.innerText = "Currency";
  var tdAmount = document.createElement("td");
  tdAmount.width = "70%";
  tdAmount.innerText = "Amount";
  tr.appendChild(tdCurrency);
  tr.appendChild(tdAmount);
  var tbody = document.createElement("tbody");
  table.appendChild(tbody);
  Object.keys(summary).forEach(function (currency) {
    if (!summary[currency]) return;
    var tr = document.createElement("tr");
    tbody.appendChild(tr);
    var tdCurrency = document.createElement("td");
    tdCurrency.innerText = currency;
    var tdAmount = document.createElement("td");
    tdAmount.className = "amount";
    tdAmount.innerText = numeral(summary[currency]).format("0,0.00");
    tr.appendChild(tdCurrency);
    tr.appendChild(tdAmount);
  });
  summaryContainer.appendChild(table);
}

function getEntry(entry) {
  var entryDiv = document.createElement("div");
  entryDiv.id = entry.entryNo;
  entryDiv.className = "entry";
  var dateCaption = document.createElement("div");
  dateCaption.className = "date";
  dateCaption.innerText = entry.documentDate;
  var customerCaption = document.createElement("div");
  customerCaption.className = "customer";
  var customerCaptionNo = document.createElement("div");
  customerCaptionNo.className = "no";
  customerCaptionNo.innerText = entry.customerNo;
  var customerCaptionName = document.createElement("div");
  customerCaptionName.className = "name";
  customerCaptionName.innerText = entry.customerName;
  customerCaption.appendChild(customerCaptionNo);
  customerCaption.appendChild(customerCaptionName);
  var amountDiv = document.createElement("div");
  amountDiv.className = "amount";

  if (entry.currency) {
    var amountCurrency = document.createElement("span");
    amountCurrency.className = "currency";
    amountCurrency.innerText = entry.currency;
    amountDiv.appendChild(amountCurrency);
  }

  var amountNumber = document.createElement("span");
  amountNumber.className = "number";
  amountNumber.innerText = numeral(entry.amount).format("0,0.00");
  amountDiv.appendChild(amountNumber);
  entryDiv.appendChild(dateCaption);
  entryDiv.appendChild(customerCaption);
  entryDiv.appendChild(amountDiv);
  return entryDiv;
}

function emptyDataContainer() {
  emptyChildrenFrom(dataContainer);
}

function addToDataContainer(entryDiv) {
  dataContainer.append(entryDiv);
}
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uLy4uL3NpbXBsZXIuY29uc3RhbnRzLmpzIiwiLi4vLi4vLi4vLi4vLi4vLi4vLi4vc2ltcGxlci5pbnRlcmZhY2UuanMiLCIuLi8uLi8uLi8uLi8uLi8uLi8uLi9zaW1wbGVyLnN0YXRlLmpzIiwiLi4vLi4vLi4vLi4vLi4vLi4vLi4vc2ltcGxlci51aS5qcyJdLCJuYW1lcyI6WyJTVU1NQVJZX0FDVElPTiIsIkFERCIsIlN5bWJvbCIsIlJFTU9WRSIsIlNpbXBsZXIiLCJpbml0aWFsaXplIiwiaW5pdGlhbGl6ZVVJIiwiU2VuZERhdGEiLCJkYXRhIiwiZm9yRWFjaCIsImVudHJ5IiwiZW50cnlEaXYiLCJnZXRFbnRyeSIsImFkZEV2ZW50TGlzdGVuZXIiLCJlbnRyeUNsaWNrZWQiLCJhZGRUb0RhdGFDb250YWluZXIiLCJyZW5kZXJTdW1tYXJ5Iiwic3VtbWFyeSIsInNlbGVjdGVkIiwiY2FsY3VsYXRlU3VtbWFyeSIsImFjdGlvbiIsImN1cnJlbmN5IiwiYW1vdW50IiwidXBkYXRlU3VtbWFyeSIsImluY2x1ZGVzIiwiY2xhc3NMaXN0IiwicmVtb3ZlIiwiZmlsdGVyIiwiZSIsImFkZCIsInB1c2giLCJkYXRhQ29udGFpbmVyIiwiZG9jdW1lbnQiLCJjcmVhdGVFbGVtZW50IiwiY2xhc3NOYW1lIiwic3VtbWFyeUNvbnRhaW5lciIsImNvbnRyb2xBZGRJbiIsImdldEVsZW1lbnRCeUlkIiwiYXBwZW5kQ2hpbGQiLCJlbXB0eUNoaWxkcmVuRnJvbSIsIm5vZGUiLCJmaXJzdENoaWxkIiwicmVtb3ZlQ2hpbGQiLCJzdW1tYXJ5TGFiZWwiLCJpbm5lclRleHQiLCJsZW5ndGgiLCJzdW1tYXJ5SW5mbyIsInRhYmxlIiwid2lkdGgiLCJ0aGVhZCIsInRyIiwidGRDdXJyZW5jeSIsInRkQW1vdW50IiwidGJvZHkiLCJPYmplY3QiLCJrZXlzIiwibnVtZXJhbCIsImZvcm1hdCIsImlkIiwiZW50cnlObyIsImRhdGVDYXB0aW9uIiwiZG9jdW1lbnREYXRlIiwiY3VzdG9tZXJDYXB0aW9uIiwiY3VzdG9tZXJDYXB0aW9uTm8iLCJjdXN0b21lck5vIiwiY3VzdG9tZXJDYXB0aW9uTmFtZSIsImN1c3RvbWVyTmFtZSIsImFtb3VudERpdiIsImFtb3VudEN1cnJlbmN5IiwiYW1vdW50TnVtYmVyIiwiZW1wdHlEYXRhQ29udGFpbmVyIiwiYXBwZW5kIl0sIm1hcHBpbmdzIjoiOzs7Ozs7OztBQUFBLElBQUFBLGNBQUEsR0FBQTtBQUNBQyxFQUFBQSxHQUFBLEVBQUFDLE1BQUEsRUFEQTtBQUVBQyxFQUFBQSxNQUFBLEVBQUFELE1BQUE7QUFGQSxDQUFBO0FDQUEsSUFBQUUsT0FBQSxHQUFBO0FBQ0FDLEVBQUFBLFVBQUEsRUFBQSxzQkFBQTtBQUNBQyxJQUFBQSxZQUFBO0FBQ0E7QUFIQSxDQUFBOztBQU1BLFNBQUFDLFFBQUEsQ0FBQUMsSUFBQSxFQUFBO0FBQ0E7QUFDQUEsRUFBQUEsSUFBQSxDQUFBQyxPQUFBLENBQUEsVUFBQUMsS0FBQSxFQUFBO0FBQ0EsUUFBQUMsUUFBQSxHQUFBQyxRQUFBLENBQUFGLEtBQUEsQ0FBQTtBQUNBQyxJQUFBQSxRQUFBLENBQUFFLGdCQUFBLENBQUEsT0FBQSxFQUFBO0FBQUEsYUFBQUMsWUFBQSxDQUFBSCxRQUFBLEVBQUFELEtBQUEsQ0FBQTtBQUFBLEtBQUE7QUFDQUssSUFBQUEsa0JBQUEsQ0FBQUosUUFBQSxDQUFBO0FBQ0EsR0FKQTtBQUtBSyxFQUFBQSxhQUFBLENBQUFDLE9BQUEsQ0FBQTtBQUNBOztBQ2RBLElBQUFDLFFBQUEsR0FBQSxFQUFBO0FBQ0EsSUFBQUQsT0FBQSxHQUFBLEVBQUE7O0FBRUEsU0FBQUUsZ0JBQUEsQ0FBQVQsS0FBQSxFQUFBVSxNQUFBLEVBQUE7QUFDQSxNQUFBQyxRQUFBLEdBQUFYLEtBQUEsQ0FBQVcsUUFBQSxJQUFBLEtBQUE7QUFDQUosRUFBQUEsT0FBQSxxQkFBQUEsT0FBQSxzQkFBQUksUUFBQSxFQUFBSixPQUFBLENBQUFJLFFBQUEsQ0FBQSxJQUFBLENB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LENBQUEyQixXQUFBLENBQUF3QixlQUFBO0FBQ0FuRCxFQUFBQSxRQUFBLENBQUEyQixXQUFBLENBQUE2QixTQUFBO0FBRUEsU0FBQXhELFFBQUE7QUFDQTs7QUFFQSxTQUFBMkQsa0JBQUEsR0FBQTtBQUNBL0IsRUFBQUEsaUJBQUEsQ0FBQVIsYUFBQSxDQUFBO0FBQ0E7O0FBRUEsU0FBQWhCLGtCQUFBLENBQUFKLFFBQUEsRUFBQTtBQUNBb0IsRUFBQUEsYUFBQSxDQUFBd0MsTUFBQSxDQUFBNUQsUUFBQTtBQUNBIiwiZmlsZSI6InNpbXBsZXIubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiY29uc3QgU1VNTUFSWV9BQ1RJT04gPSB7XHJcbiAgICBBREQ6IFN5bWJvbCgpLFxyXG4gICAgUkVNT1ZFOiBTeW1ib2woKVxyXG59O1xyXG4iLCJjb25zdCBTaW1wbGVyID0ge1xyXG4gICAgaW5pdGlhbGl6ZTogKCkgPT4ge1xyXG4gICAgICAgIGluaXRpYWxpemVVSSgpO1xyXG4gICAgfVxyXG59O1xyXG5cclxuZnVuY3Rpb24gU2VuZERhdGEoZGF0YSkge1xyXG4gICAgLy8gVE9ETzogLi4uIGFuZCB0aGlzIG9uZSBpcyBwcmV0dHkgdWdseSwgdG9vXHJcbiAgICBkYXRhLmZvckVhY2goZW50cnkgPT4ge1xyXG4gICAgICAgIHZhciBlbnRyeURpdiA9IGdldEVudHJ5KGVudHJ5KTtcclxuICAgICAgICBlbnRyeURpdi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4gZW50cnlDbGlja2VkKGVudHJ5RGl2LCBlbnRyeSkpO1xyXG4gICAgICAgIGFkZFRvRGF0YUNvbnRhaW5lcihlbnRyeURpdik7XHJcbiAgICB9KTtcclxuICAgIHJlbmRlclN1bW1hcnkoc3VtbWFyeSk7XHJcbn1cclxuIiwidmFyIHNlbGVjdGVkID0gW107XHJcbnZhciBzdW1tYXJ5ID0ge307XHJcblxyXG5mdW5jdGlvbiBjYWxjdWxhdGVTdW1tYXJ5KGVudHJ5LCBhY3Rpb24pIHtcclxuICAgIGNvbnN0IGN1cnJlbmN5ID0gZW50cnkuY3VycmVuY3kgfHwgXCJMQ1lcIjtcclxuICAgIHN1bW1hcnkgPSB7Li4uc3VtbWFyeSwgW2N1cnJlbmN5XTogc3VtbWFyeVtjdXJyZW5jeV0gfHwgMCB9O1xyXG5cclxuICAgIHN3aXRjaCAoYWN0aW9uKSB7XHJcbiAgICAgICAgY2FzZSBTVU1NQVJZX0FDVElPTi5SRU1PVkU6XHJcbiAgICAgICAgICAgIHN1bW1hcnlbY3VycmVuY3ldIC09IGVudHJ5LmFtb3VudDtcclxuICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgY2FzZSBTVU1NQVJZX0FDVElPTi5BREQ6XHJcbiAgICAgICAgICAgIHN1bW1hcnlbY3VycmVuY3ldICs9IGVudHJ5LmFtb3VudDtcclxuICAgICAgICAgICAgYnJlYWs7XHJcbiAgICB9XHJcbn1cclxuXHJcbmZ1bmN0aW9uIHVwZGF0ZVN1bW1hcnkoZW50cnksIGFjdGlvbikge1xyXG4gICAgY2FsY3VsYXRlU3VtbWFyeShlbnRyeSwgYWN0aW9uKTtcclxuICAgIHJlbmRlclN1bW1hcnkoc3VtbWFyeSk7XHJcbn1cclxuXHJcbi8vIFRPRE86IFRoaXMgb25lIGlzIHN0aWxsIHByZXR0eSB1Z2x5XHJcbmZ1bmN0aW9uIGVudHJ5Q2xpY2tlZChlbnRyeURpdiwgZW50cnkpIHtcclxuICAgIGlmIChzZWxlY3RlZC5pbmNsdWRlcyhlbnRyeSkpIHtcclxuICAgICAgICBlbnRyeURpdi5jbGFzc0xpc3QucmVtb3ZlKFwic2VsZWN0ZWRcIik7XHJcbiAgICAgICAgc2VsZWN0ZWQgPSBzZWxlY3RlZC5maWx0ZXIoZSA9PiBlICE9PSBlbnRyeSk7XHJcbiAgICAgICAgdXBkYXRlU3VtbWFyeShlbnRyeSwgU1VNTUFSWV9BQ1RJT04uUkVNT1ZFKVxyXG4gICAgfSBlbHNlIHtcclxuICAgICAgICBlbnRyeURpdi5jbGFzc0xpc3QuYWRkKFwic2VsZWN0ZWRcIik7XHJcbiAgICAgICAgc2VsZWN0ZWQucHVzaChlbnRyeSk7XHJcbiAgICAgICAgdXBkYXRlU3VtbWFyeShlbnRyeSwgU1VNTUFSWV9BQ1RJT04uQUREKTtcclxuICAgIH1cclxufVxyXG4iLCJjb25zdCBkYXRhQ29udGFpbmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcclxuZGF0YUNvbnRhaW5lci5jbGFzc05hbWUgPSBcImRhdGFcIjtcclxuXHJcbmNvbnN0IHN1bW1hcnlDb250YWluZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xyXG5zdW1tYXJ5Q29udGFpbmVyLmNsYXNzTmFtZSA9IFwic3VtbWFyeVwiO1xyXG5cclxuZnVuY3Rpb24gaW5pdGlhbGl6ZVVJKCkge1xyXG4gICAgdmFyIGNvbnRyb2xBZGRJbiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwiY29udHJvbEFkZEluXCIpO1xyXG5cclxuICAgIGNvbnRyb2xBZGRJbi5hcHBlbmRDaGlsZChkYXRhQ29udGFpbmVyKTtcclxuICAgIGNvbnRyb2xBZGRJbi5hcHBlbmRDaGlsZChzdW1tYXJ5Q29udGFpbmVyKTtcclxufVxyXG5cclxuZnVuY3Rpb24gZW1wdHlDaGlsZHJlbkZyb20obm9kZSkge1xyXG4gICAgd2hpbGUgKG5vZGUuZmlyc3RDaGlsZClcclxuICAgICAgICBub2RlLnJlbW92ZUNoaWxkKG5vZGUuZmlyc3RDaGlsZCk7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIHJlbmRlclN1bW1hcnkoc3VtbWFyeSkge1xyXG4gICAgZW1wdHlDaGlsZHJlbkZyb20oc3VtbWFyeUNvbnRhaW5lcik7XHJcblxyXG4gICAgdmFyIHN1bW1hcnlMYWJlbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XHJcbiAgICBzdW1tYXJ5TGFiZWwuY2xhc3NOYW1lID0gXCJsYWJlbFwiO1xyXG4gICAgc3VtbWFyeUxhYmVsLmlubmVyVGV4dCA9IFwiUGF5bWVudCBzdW1tYXJ5XCI7XHJcbiAgICBzdW1tYXJ5Q29udGFpbmVyLmFwcGVuZENoaWxkKHN1bW1hcnlMYWJlbCk7XHJcblxyXG4gICAgaWYgKCFzZWxlY3RlZC5sZW5ndGgpIHtcclxuICAgICAgICB2YXIgc3VtbWFyeUluZm8gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xyXG4gICAgICAgIHN1bW1hcnlJbmZvLmNsYXNzTmFtZSA9IFwiaW5mb1wiO1xyXG4gICAgICAgIHN1bW1hcnlJbmZvLmlubmVyVGV4dCA9IFwiKG5vIGludm9pY2VzIHNlbGVjdGVkKVwiO1xyXG4gICAgICAgIHN1bW1hcnlDb250YWluZXIuYXBwZW5kQ2hpbGQoc3VtbWFyeUluZm8pO1xyXG4gICAgICAgIHJldHVybjtcclxuICAgIH1cclxuXHJcbiAgICB2YXIgdGFibGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwidGFibGVcIik7XHJcbiAgICB0YWJsZS53aWR0aCA9IFwiODAlXCI7XHJcbiAgICB2YXIgdGhlYWQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwidGhlYWRcIik7XHJcbiAgICB0YWJsZS5hcHBlbmRDaGlsZCh0aGVhZCk7XHJcblxyXG4gICAgdmFyIHRyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInRyXCIpO1xyXG4gICAgdGhlYWQuYXBwZW5kQ2hpbGQodHIpO1xyXG5cclxuICAgIHZhciB0ZEN1cnJlbmN5ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInRkXCIpO1xyXG4gICAgdGRDdXJyZW5jeS53aWR0aCA9IFwiMzAlXCI7XHJcbiAgICB0ZEN1cnJlbmN5LmlubmVyVGV4dCA9IFwiQ3VycmVuY3lcIjtcclxuICAgIHZhciB0ZEFtb3VudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJ0ZFwiKTtcclxuICAgIHRkQW1vdW50LndpZHRoID0gXCI3MCVcIjtcclxuICAgIHRkQW1vdW50LmlubmVyVGV4dCA9IFwiQW1vdW50XCI7XHJcblxyXG4gICAgdHIuYXBwZW5kQ2hpbGQodGRDdXJyZW5jeSk7XHJcbiAgICB0ci5hcHBlbmRDaGlsZCh0ZEFtb3VudCk7XHJcblxyXG4gICAgdmFyIHRib2R5ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInRib2R5XCIpO1xyXG4gICAgdGFibGUuYXBwZW5kQ2hpbGQodGJvZHkpO1xyXG5cclxuICAgIE9iamVjdC5rZXlzKHN1bW1hcnkpLmZvckVhY2goY3VycmVuY3kgPT4ge1xyXG4gICAgICAgIGlmICghc3VtbWFyeVtjdXJyZW5jeV0pXHJcbiAgICAgICAgICAgIHJldHVybjtcclxuXHJcbiAgICAgICAgdmFyIHRyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInRyXCIpO1xyXG4gICAgICAgIHRib2R5LmFwcGVuZENoaWxkKHRyKTtcclxuXHJcbiAgICAgICAgdmFyIHRkQ3VycmVuY3kgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwidGRcIik7XHJcbiAgICAgICAgdGRDdXJyZW5jeS5pbm5lclRleHQgPSBjdXJyZW5jeTtcclxuICAgICAgICB2YXIgdGRBbW91bnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwidGRcIik7XHJcbiAgICAgICAgdGRBbW91bnQuY2xhc3NOYW1lID0gXCJhbW91bnRcIjtcclxuICAgICAgICB0ZEFtb3VudC5pbm5lclRleHQgPSBudW1lcmFsKHN1bW1hcnlbY3VycmVuY3ldKS5mb3JtYXQoXCIwLDAuMDBcIik7XHJcblxyXG4gICAgICAgIHRyLmFwcGVuZENoaWxkKHRkQ3VycmVuY3kpO1xyXG4gICAgICAgIHRyLmFwcGVuZENoaWxkKHRkQW1vdW50KTtcclxuICAgIH0pO1xyXG4gICAgc3VtbWFyeUNvbnRhaW5lci5hcHBlbmRDaGlsZCh0YWJsZSk7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGdldEVudHJ5KGVudHJ5KSB7XHJcbiAgICBsZXQgZW50cnlEaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xyXG4gICAgZW50cnlEaXYuaWQgPSBlbnRyeS5lbnRyeU5vO1xyXG4gICAgZW50cnlEaXYuY2xhc3NOYW1lID0gXCJlbnRyeVwiO1xyXG5cclxuICAgIGxldCBkYXRlQ2FwdGlvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XHJcbiAgICBkYXRlQ2FwdGlvbi5jbGFzc05hbWUgPSBcImRhdGVcIjtcclxuICAgIGRhdGVDYXB0aW9uLmlubmVyVGV4dCA9IGVudHJ5LmRvY3VtZW50RGF0ZTtcclxuXHJcbiAgICBsZXQgY3VzdG9tZXJDYXB0aW9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcclxuICAgIGN1c3RvbWVyQ2FwdGlvbi5jbGFzc05hbWUgPSBcImN1c3RvbWVyXCI7XHJcblxyXG4gICAgbGV0IGN1c3RvbWVyQ2FwdGlvbk5vID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcclxuICAgIGN1c3RvbWVyQ2FwdGlvbk5vLmNsYXNzTmFtZSA9IFwibm9cIjtcclxuICAgIGN1c3RvbWVyQ2FwdGlvbk5vLmlubmVyVGV4dCA9IGVudHJ5LmN1c3RvbWVyTm87XHJcblxyXG4gICAgbGV0IGN1c3RvbWVyQ2FwdGlvbk5hbWUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xyXG4gICAgY3VzdG9tZXJDYXB0aW9uTmFtZS5jbGFzc05hbWUgPSBcIm5hbWVcIjtcclxuICAgIGN1c3RvbWVyQ2FwdGlvbk5hbWUuaW5uZXJUZXh0ID0gZW50cnkuY3VzdG9tZXJOYW1lO1xyXG5cclxuICAgIGN1c3RvbWVyQ2FwdGlvbi5hcHBlbmRDaGlsZChjdXN0b21lckNhcHRpb25Obyk7XHJcbiAgICBjdXN0b21lckNhcHRpb24uYXBwZW5kQ2hpbGQoY3VzdG9tZXJDYXB0aW9uTmFtZSk7XHJcblxyXG4gICAgbGV0IGFtb3VudERpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XHJcbiAgICBhbW91bnREaXYuY2xhc3NOYW1lID0gXCJhbW91bnRcIjtcclxuXHJcbiAgICBpZiAoZW50cnkuY3VycmVuY3kpIHtcclxuICAgICAgICBsZXQgYW1vdW50Q3VycmVuY3kgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwic3BhblwiKTtcclxuICAgICAgICBhbW91bnRDdXJyZW5jeS5jbGFzc05hbWUgPSBcImN1cnJlbmN5XCI7XHJcbiAgICAgICAgYW1vdW50Q3VycmVuY3kuaW5uZXJUZXh0ID0gZW50cnkuY3VycmVuY3k7XHJcbiAgICAgICAgYW1vdW50RGl2LmFwcGVuZENoaWxkKGFtb3VudEN1cnJlbmN5KTtcclxuICAgIH1cclxuXHJcbiAgICBsZXQgYW1vdW50TnVtYmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInNwYW5cIik7XHJcbiAgICBhbW91bnROdW1iZXIuY2xhc3NOYW1lID0gXCJudW1iZXJcIjtcclxuICAgIGFtb3VudE51bWJlci5pbm5lclRleHQgPSBudW1lcmFsKGVudHJ5LmFtb3VudCkuZm9ybWF0KFwiMCwwLjAwXCIpO1xyXG4gICAgYW1vdW50RGl2LmFwcGVuZENoaWxkKGFtb3VudE51bWJlcik7XHJcblxyXG4gICAgZW50cnlEaXYuYXBwZW5kQ2hpbGQoZGF0ZUNhcHRpb24pO1xyXG4gICAgZW50cnlEaXYuYXBwZW5kQ2hpbGQoY3VzdG9tZXJDYXB0aW9uKTtcclxuICAgIGVudHJ5RGl2LmFwcGVuZENoaWxkKGFtb3VudERpdik7XHJcblxyXG4gICAgcmV0dXJuIGVudHJ5RGl2O1xyXG59XHJcblxyXG5mdW5jdGlvbiBlbXB0eURhdGFDb250YWluZXIoKSB7XHJcbiAgICBlbXB0eUNoaWxkcmVuRnJvbShkYXRhQ29udGFpbmVyKTtcclxufVxyXG5cclxuZnVuY3Rpb24gYWRkVG9EYXRhQ29udGFpbmVyKGVudHJ5RGl2KSB7XHJcbiAgICBkYXRhQ29udGFpbmVyLmFwcGVuZChlbnRyeURpdik7XHJcbn0iXX0=
